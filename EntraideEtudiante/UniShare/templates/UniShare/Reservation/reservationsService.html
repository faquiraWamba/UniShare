{% extends "UniShare/base.html" %}
{% load static %}

{% block content %}
<main class="dashboard-page">
    <div class="page-header">
        <div class="header-titles">
            <h1><i class="fas fa-tasks"></i> Gestion des réservations</h1>
            <p class="subtitle">Demandes pour le service : <strong>{{ service.titre }}</strong></p>
        </div>
        <a href="{% url 'serviceDetail' service.id_service %}" class="btn-nav outline">
            <i class="fas fa-arrow-left"></i> retour au service
        </a>
    </div>

    {% if lesreservations %}
        <div class="reservations-grid">
            {% for reservation in lesreservations %}
                <div class="reservation-card">
                    <div class="res-status-bar {{ reservation.statut|lower }}"></div>
                    
                    <div class="res-card-body">
                        <div class="user-profile-summary">
                            {% if reservation.demandeur.photo %}
                                <img src="{{ reservation.demandeur.photo.url }}" alt="Avatar" class="res-avatar">
                            {% else %}
                                <i class="fas fa-user-circle" style="font-size: 80px; color: #999;"></i>
                            {% endif %}
                            <div class="user-details">
                                <h3>{{ reservation.demandeur.prenom }} {{ reservation.demandeur.nom }}</h3>
                                <p class="user-school"><i class="fas fa-university"></i> {{ reservation.demandeur.ecole }}</p>
                                <small style="display: block; color: #666;">{{ reservation.demandeur.get_niveau_display }} • {{ reservation.demandeur.formation }}</small>
                                <span class="badge-niveau">Promotion: {{ reservation.demandeur.promo }}</span>
                            </div>
                            <div class="status-badge-zone">
                                <span class="status-pill {{ reservation.statut|lower }}">
                                    {{ reservation.get_statut_display }}
                                </span>
                            </div>
                        </div>

                        <div class="res-info-list">
                            <div class="info-item">
                                <i class="fas fa-clock"></i>
                                <span>Demande reçue le {{ reservation.date_creation|date:"d M Y à H:i" }}</span>
                            </div>
                        </div>

                        <div class="res-card-actions">
                            <form method="POST" action="{% url 'accepterReservation' reservation.id_reservation %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn-action" style="padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-check"></i> Accepter
                                </button>
                            </form>
                            <form method="POST" action="{% url 'refuserReservation' reservation.id_reservation %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn-action-danger" style="padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; background-color: #dc3545; color: white;">
                                    <i class="fas fa-times"></i> Refuser
                                </button>
                            </form>
                            {% if reservation.statut == "ATT" and reservations_en_attente > 1 %}
                            <form method="POST" action="{% url 'accepterEtRefuserAutres' reservation.id_reservation %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn-action-secondary" style="padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; background-color: #6c757d; color: white;" title="Accepter cette demande et refuser toutes les autres">
                                    <i class="fas fa-check-double"></i> Accepter et refuser les autres
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-inbox"></i></div>
            <p>Aucune réservation n'a été effectuée pour le moment.</p>
            <a href="{% url 'mesServices' %}" class="link-back">Retour à mes services</a>
        </div>
    {% endif %}
</main>
{% endblock %}