{% extends "UniShare/base.html" %}
{% load static %}

{% block content %}
<div class="admin-profile-view"> <main class="profile-page"></main>
<main class="profile-page">
    <div class="profile-header">
        <h1>Profil Utilisateur - Vue Administrative</h1>
        <a href="{% url 'listeUtilisateurs' %}" class="btn-back">
             Retour à la liste <i class="fas fa-arrow-right"></i>
        </a>
    </div>

    <div class="profile-container">
        <div class="profile-main">
            <section class="profile-card">
                <div class="profile-avatar">
                    {% if utilisateur.photo %}
                        <img src="{{ utilisateur.photo.url }}" alt="Avatar" class="large-avatar">
                    {% else %}
                        <i class="fas fa-user-circle" style="font-size: 80px; color: #ddd;"></i>
                    {% endif %}
                </div>

                <div class="profile-info">
                    <h2>{{ utilisateur.prenom }} {{ utilisateur.nom }}</h2>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Email</label>
                            <p>{{ utilisateur.email }}</p>
                        </div>
                        
                        <div class="info-item">
                            <label>Rôle</label>
                            <p>
                                {% if utilisateur.role == "ETU" %}
                                    <span class="badge badge-student">Étudiant</span>
                                {% elif utilisateur.role == "ANC" %}
                                    <span class="badge badge-alumni">Ancien</span>
                                {% elif utilisateur.role == "ADM" %}
                                    <span class="badge badge-admin">Admin</span>
                                {% endif %}
                            </p>
                        </div>

                        {% if etudiant %}
                        <div class="info-item">
                            <label>École</label>
                            <p>{{ etudiant.ecole }}</p>
                        </div>
                        
                        <div class="info-item">
                            <label>Formation</label>
                            <p>{{ etudiant.formation }}</p>
                        </div>
                        
                        <div class="info-item">
                            <label>Niveau</label>
                            <p>{{ etudiant.get_niveau_display }}</p>
                        </div>
                        
                        <div class="info-item">
                            <label>Promo</label>
                            <p>{{ etudiant.promo }}</p>
                        </div>

                        <div class="info-item">
                            <label>Statut du compte</label>
                            <p>
                                {% if etudiant.statut_compte == "ACTIF" %}
                                    <span class="status active"><i class="fas fa-check-circle"></i> Actif</span>
                                {% elif etudiant.statut_compte == "SUSP" %}
                                    <span class="status suspended"><i class="fas fa-ban"></i> Suspendu</span>
                                {% endif %}
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </section>
        </div>

        <aside class="profile-sidebar">
            <div class="sidebar-card actions-card">
                <h3>Actions Administratives</h3>
                
                <form method="post" class="action-form">
                    {% csrf_token %}
                    
                    {% if etudiant and etudiant.statut_compte == "ACTIF" %}
                    <button type="submit" name="action" value="suspendre" class="btn btn-warning" onclick="return confirm('Êtes-vous sûr de vouloir suspendre ce compte ?')">
                        <i class="fas fa-ban"></i> Suspendre le compte
                    </button>
                    {% elif etudiant and etudiant.statut_compte == "SUSP" %}
                    <button type="submit" name="action" value="reactiver" class="btn btn-success" onclick="return confirm('Êtes-vous sûr de vouloir réactiver ce compte ?')">
                        <i class="fas fa-check-circle"></i> Réactiver le compte
                    </button>
                    {% endif %}
                </form>

                <form method="post" class="action-form" style="margin-top: 1rem;">
                    {% csrf_token %}
                    <button type="submit" name="action" value="supprimer" class="btn btn-danger" onclick="return confirm('Êtes-vous sûr de vouloir supprimer définitivement ce compte ? Cette action est irréversible.')">
                        <i class="fas fa-trash-alt"></i> Supprimer le compte
                    </button>
                </form>
            </div>
        </aside>
    </div>
</main>

<style>
/* --- Structure Globale Compacte --- */
.profile-page {
    padding: 1rem 2rem;
    max-height: 100vh; /* Verrouille la hauteur sur l'écran */
    box-sizing: border-box;
}

.profile-header {
    display: flex;
    justify-content: space-between; /* Pousse le bouton à droite */
    align-items: center;
    margin-bottom: 1rem;
    border-bottom: 2px solid #f1f5f9;
    padding-bottom: 0.5rem;
}

.profile-header h1 {
    font-size: 1.3rem;
    margin: 0;
    color: #1e293b;
}

/* Bouton Retour Couleur Charte (Bleu UniShare) */
.btn-back {
    padding: 0.4rem 1rem;
    background: #4f46e5; /* Remplace par ta couleur exacte si besoin */
    border: none;
    border-radius: 6px;
    text-decoration: none;
    color: white !important;
    font-weight: 600;
    font-size: 0.85rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-back:hover {
    background: #4338ca;
    transform: translateX(3px);
}

/* Container en 2 colonnes */
.profile-container {
    display: grid;
    grid-template-columns: 1fr 280px;
    gap: 1.2rem;
}

/* Carte principale réduite */
.profile-card {
    background: white;
    border-radius: 12px;
    padding: 1.25rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    align-items: flex-start; /* Aligne avatar et texte horizontalement */
    gap: 1.5rem;
}

.profile-avatar {
    margin-bottom: 0;
    flex-shrink: 0;
}

.large-avatar {
    width: 80px; /* Taille réduite */
    height: 80px;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
}

.profile-info {
    flex-grow: 1;
}

.profile-info h2 {
    margin: 0 0 1rem 0;
    font-size: 1.4rem;
    color: #0f172a;
}

/* Grille d'infos sur 3 colonnes pour gagner de la hauteur */
.info-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.8rem;
}

.info-item label {
    font-weight: 700;
    color: #64748b;
    font-size: 0.65rem;
    text-transform: uppercase;
    margin-bottom: 2px;
}

.info-item p {
    font-size: 0.85rem;
    padding: 0.4rem;
    background: #f8fafc;
    border-radius: 6px;
    border: 1px solid #f1f5f9;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Sidebar Administrative */
.sidebar-card {
    background: #fff;
    border-radius: 12px;
    padding: 1rem;
    border: 1px solid #e2e8f0;
}

.sidebar-card h3 {
    font-size: 0.85rem;
    margin-bottom: 1rem;
    color: #475569;
    text-transform: uppercase;
}

.action-form {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
}

.btn {
    padding: 0.6rem;
    font-size: 0.8rem;
    width: 100%;
}

/* Statuts et Badges miniatures */
.badge, .status {
    padding: 0.2rem 0.5rem;
    font-size: 0.7rem;
    font-weight: 700;
}

.badge-student { background: #e0f2fe; color: #0369a1; }
.badge-alumni { background: #fef3c7; color: #92400e; }
.badge-admin { background: #dcfce7; color: #166534; }
/* --- Modification du bouton de suspension (Warning) --- */
.admin-profile-view .btn-warning {
    background-color: #ff9800; /* Orange vif pour attirer l'attention */
    color: white !important;   /* Texte en blanc pour le contraste */
    border: none;
}

.admin-profile-view .btn-warning:hover {
    background-color: #f57c00; /* Orange plus sombre au survol */
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* --- Couleurs des badges de Statut du compte --- */

/* Statut ACTIF (Vert) */
.admin-profile-view .status.active {
    background-color: #dcfce7; /* Fond vert très clair */
    color: #15803d;           /* Texte vert foncé */
    border: 1px solid #bbf7d0;
}

.admin-profile-view .status.active i {
    color: #16a34a;           /* Icône check un peu plus vive */
}

/* Statut SUSPENDU (Rouge/Rose) */
.admin-profile-view .status.suspended {
    background-color: #fee2e2; /* Fond rouge très clair */
    color: #b91c1c;           /* Texte rouge foncé */
    border: 1px solid #fecaca;
}

.admin-profile-view .status.suspended i {
    color: #dc2626;           /* Icône ban plus vive */
}
/* Responsive */
@media (max-width: 1024px) {
    .info-grid { grid-template-columns: repeat(2, 1fr); }
}
</style>
{% endblock %}
